# ğŸš€ CI/CD éƒ¨ç½²å¿«é€ŸæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æ­¤åˆ†æ”¯ `cicd-docker-deploy` æ·»åŠ äº†å®Œæ•´çš„ Docker å®¹å™¨åŒ–å’Œ GitHub Actions CI/CD æ”¯æŒï¼Œå¯ä»¥è‡ªåŠ¨éƒ¨ç½²åˆ°æ‚¨çš„æœåŠ¡å™¨ã€‚

## ğŸ¯ æ–°å¢åŠŸèƒ½

### ğŸ“¦ Docker åŒ–
- **Dockerfile**: åŸºäº Node.js 18 Alpine çš„è½»é‡é•œåƒ
- **docker-compose.yml**: æœ¬åœ°å¼€å‘ç¯å¢ƒæ”¯æŒ
- **å¥åº·æ£€æŸ¥**: å†…ç½®æœåŠ¡å¥åº·ç›‘æ§
- **å¤šç¯å¢ƒæ”¯æŒ**: å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒé…ç½®

### ğŸ”„ CI/CD æµç¨‹
- **è‡ªåŠ¨æµ‹è¯•**: ä»£ç æ¨é€æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
- **é•œåƒæ„å»º**: è‡ªåŠ¨æ„å»ºå¹¶æ¨é€åˆ° GitHub Container Registry
- **è‡ªåŠ¨éƒ¨ç½²**: æ¨é€åˆ° main åˆ†æ”¯æ—¶è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨
- **å¥åº·æ£€æŸ¥**: éƒ¨ç½²åè‡ªåŠ¨éªŒè¯æœåŠ¡çŠ¶æ€

### ğŸ› ï¸ å·¥å…·è„šæœ¬
- **start.sh**: å¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼Œæ”¯æŒå¤šç§æ¨¡å¼
- **deploy.sh**: æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬
- **healthcheck.sh**: å®¹å™¨å¥åº·æ£€æŸ¥è„šæœ¬

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æœ¬åœ°å¼€å‘

```bash
# ä½¿ç”¨ Node.js
./start.sh dev

# ä½¿ç”¨ Docker
./start.sh docker
```

### 2. æœåŠ¡å™¨é…ç½®

#### æ ‡å‡†é…ç½®

åœ¨ GitHub ä»“åº“çš„ **Settings > Secrets and variables > Actions** ä¸­æ·»åŠ ï¼š

| å¯†é’¥åç§° | æè¿° | ç¤ºä¾‹ |
|---------|------|------|
| `SERVER_HOST` | æœåŠ¡å™¨ IP | `192.168.1.100` |
| `SERVER_USER` | SSH ç”¨æˆ·å | `ubuntu` |
| `SERVER_SSH_KEY` | SSH ç§é’¥ | `-----BEGIN RSA...` |
| `SERVER_PORT` | SSH ç«¯å£ | `22` |

#### Tailscale ç½‘ç»œé…ç½®ï¼ˆæ¨èï¼‰

å¦‚æœæ‚¨ä½¿ç”¨ Tailscale ç§æœ‰ç½‘ç»œï¼Œè¿˜éœ€è¦æ·»åŠ ï¼š

| å¯†é’¥åç§° | æè¿° | è·å–æ–¹å¼ |
|---------|------|---------|
| `TAILSCALE_OAUTH_CLIENT_ID` | Tailscale OAuth ID | [Tailscale æ§åˆ¶å°](https://login.tailscale.com/admin/settings/oauth) |
| `TAILSCALE_OAUTH_SECRET` | Tailscale OAuth å¯†é’¥ | Tailscale æ§åˆ¶å° |
| `SERVER_HOST` | æœåŠ¡å™¨ Tailscale IP | `100.64.x.x` æˆ–æœºå™¨å |

> ğŸ“– **è¯¦ç»†é…ç½®**: æŸ¥çœ‹ [Tailscaleéƒ¨ç½²é…ç½®.md](./Tailscaleéƒ¨ç½²é…ç½®.md) äº†è§£å®Œæ•´çš„ Tailscale è®¾ç½®æ­¥éª¤

### 3. è‡ªåŠ¨éƒ¨ç½²

1. å°†åˆ†æ”¯åˆå¹¶åˆ° mainï¼š
   ```bash
   git checkout main
   git merge cicd-docker-deploy
   git push origin main
   ```

2. GitHub Actions å°†è‡ªåŠ¨ï¼š
   - è¿è¡Œæµ‹è¯•
   - æ„å»º Docker é•œåƒ
   - æ¨é€åˆ° GitHub Container Registry
   - éƒ¨ç½²åˆ°æ‚¨çš„æœåŠ¡å™¨

### 4. ç›‘æ§æœåŠ¡

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./start.sh status

# æŸ¥çœ‹æ—¥å¿—
./start.sh logs

# åœ¨æœåŠ¡å™¨ä¸Šæ£€æŸ¥
curl http://your-server:3000/status
```

## ğŸ“ æ–°å¢æ–‡ä»¶ç»“æ„

```
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ ci-cd.yml              # GitHub Actions å·¥ä½œæµ
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ deploy.sh              # æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ Dockerfile                 # Docker é•œåƒé…ç½®
â”œâ”€â”€ docker-compose.yml         # Docker Compose é…ç½®
â”œâ”€â”€ healthcheck.sh             # å¥åº·æ£€æŸ¥è„šæœ¬
â”œâ”€â”€ start.sh                   # å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ .dockerignore              # Docker å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .env.example               # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ Dockeréƒ¨ç½²æŒ‡å—.md          # è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
```

## ğŸ”§ å¯ç”¨å‘½ä»¤

```bash
# å¼€å‘
./start.sh dev              # æœ¬åœ°å¼€å‘
./start.sh docker           # Docker å¼€å‘ç¯å¢ƒ

# æ„å»ºå’Œæµ‹è¯•
./start.sh build            # æ„å»ºé•œåƒ
./start.sh test             # è¿è¡Œæµ‹è¯•

# è¿ç»´
./start.sh status           # æ£€æŸ¥çŠ¶æ€
./start.sh logs             # æŸ¥çœ‹æ—¥å¿—
./start.sh clean            # æ¸…ç†èµ„æº
```

## ğŸŒ éƒ¨ç½²æµç¨‹

1. **ä»£ç æ¨é€** â†’ è§¦å‘ GitHub Actions
2. **è‡ªåŠ¨æµ‹è¯•** â†’ éªŒè¯ä»£ç è´¨é‡
3. **æ„å»ºé•œåƒ** â†’ æ‰“åŒ…åº”ç”¨åˆ°å®¹å™¨
4. **æ¨é€é•œåƒ** â†’ ä¸Šä¼ åˆ° GitHub Container Registry
5. **SSH éƒ¨ç½²** â†’ è¿æ¥æœåŠ¡å™¨å¹¶æ›´æ–°å®¹å™¨
6. **å¥åº·æ£€æŸ¥** â†’ éªŒè¯éƒ¨ç½²æˆåŠŸ

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æœåŠ¡å¥åº·
- **çŠ¶æ€ç«¯ç‚¹**: `http://your-server:3000/status`
- **å¥åº·æ£€æŸ¥**: å®¹å™¨å†…ç½®å¥åº·ç›‘æ§
- **æ—¥å¿—æ”¶é›†**: Docker æ—¥å¿—ç»Ÿä¸€ç®¡ç†

### å®¹å™¨ç®¡ç†
```bash
# åœ¨æœåŠ¡å™¨ä¸Š
docker ps                        # æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
docker logs dom-catcher-server    # æŸ¥çœ‹æ—¥å¿—
docker stats dom-catcher-server   # æŸ¥çœ‹èµ„æºä½¿ç”¨
```

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **SSH å¯†é’¥**: ç¡®ä¿ SSH ç§é’¥å®‰å…¨å­˜å‚¨åœ¨ GitHub Secrets
2. **é˜²ç«å¢™**: åªå¼€æ”¾å¿…è¦ç«¯å£ (3000, 22)
3. **æƒé™æ§åˆ¶**: ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œå®¹å™¨
4. **å®šæœŸæ›´æ–°**: åŠæ—¶æ›´æ–°åŸºç¡€é•œåƒå’Œä¾èµ–

## ğŸ“– è¯¦ç»†æ–‡æ¡£

- **[Dockeréƒ¨ç½²æŒ‡å—.md](./Dockeréƒ¨ç½²æŒ‡å—.md)**: å®Œæ•´éƒ¨ç½²æ–‡æ¡£
- **[GitHub Actions å·¥ä½œæµ](./.github/workflows/ci-cd.yml)**: CI/CD é…ç½®è¯¦æƒ…

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å®¹å™¨æ— æ³•å¯åŠ¨**
   ```bash
   docker logs dom-catcher-server
   ```

2. **æœåŠ¡æ— æ³•è®¿é—®**
   ```bash
   # æ£€æŸ¥ç«¯å£
   netstat -tulpn | grep 3000
   
   # æ£€æŸ¥é˜²ç«å¢™
   sudo ufw status
   ```

3. **éƒ¨ç½²å¤±è´¥**
   - æ£€æŸ¥ GitHub Secrets é…ç½®
   - éªŒè¯æœåŠ¡å™¨ SSH è¿æ¥
   - æŸ¥çœ‹ Actions æ—¥å¿—

### è·å–å¸®åŠ©

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. GitHub Actions è¿è¡Œæ—¥å¿—
2. Docker å®¹å™¨æ—¥å¿—
3. æœåŠ¡å™¨ç³»ç»Ÿæ—¥å¿—

---

ğŸ‰ **éƒ¨ç½²æˆåŠŸåï¼Œæ‚¨çš„ DOM Catcher æœåŠ¡å°†é€šè¿‡ç°ä»£åŒ–çš„ CI/CD æµç¨‹è‡ªåŠ¨ç»´æŠ¤å’Œæ›´æ–°ï¼**
