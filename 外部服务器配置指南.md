# DOM Catcher 外部服务器配置指南

## 当前版本限制

DOM Catcher v1.2 为了最大化安全性，当前版本**仅支持本地服务器连接**：

- ✅ `http://localhost:3000`
- ✅ `http://127.0.0.1:8080` 
- ✅ `http://localhost:任意端口`
- ❌ 外部服务器（需要特殊配置）

## 支持外部服务器的方法

如果您需要连接外部服务器，有以下几种方法：

### 方法 1：本地代理（推荐）

使用本地代理服务器转发请求到外部服务器：

```bash
# 使用 nginx 作为代理
server {
    listen 3000;
    location / {
        proxy_pass https://your-external-server.com;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}

# 或使用简单的 Node.js 代理
const express = require('express');
const { createProxyMiddleware } = require('http-proxy-middleware');

const app = express();
app.use('/', createProxyMiddleware({
    target: 'https://your-external-server.com',
    changeOrigin: true
}));
app.listen(3000);
```

### 方法 2：SSH 隧道

通过 SSH 隧道将远程服务器映射到本地：

```bash
# 将远程服务器的 3000 端口映射到本地 3000 端口
ssh -L 3000:localhost:3000 user@your-server.com

# 然后在扩展中使用 http://localhost:3000
```

### 方法 3：开发版本

如果您是开发者，可以修改 manifest.json 添加外部权限：

```json
{
  "host_permissions": [
    "http://localhost:*/",
    "http://127.0.0.1:*/",
    "https://your-domain.com/*"
  ]
}
```

**注意**：这需要重新打包和安装扩展。

### 方法 4：企业版本

我们正在开发企业版本，将支持：
- 自定义域名白名单
- 管理员配置的可信服务器列表
- 增强的安全验证

## 为什么限制外部连接？

1. **安全考虑**：防止扩展被恶意利用连接任意服务器
2. **隐私保护**：确保数据不会被意外发送到不可信的第三方
3. **合规要求**：符合 Chrome Web Store 的安全政策
4. **用户信任**：明确的权限边界增强用户信心

## 本地开发建议

对于开发和测试，推荐以下设置：

```javascript
// 简单的本地测试服务器
const express = require('express');
const cors = require('cors');
const app = express();

app.use(cors());
app.use(express.json());

// 状态检查端点
app.get('/status', (req, res) => {
  res.json({
    status: 'running',
    message: 'DOM Catcher 本地测试服务器',
    timestamp: new Date().toISOString()
  });
});

// 接收数据端点
app.post('/receive-dom', (req, res) => {
  console.log('接收到数据:', req.body);
  res.json({ success: true });
});

app.listen(3000, () => {
  console.log('测试服务器运行在 http://localhost:3000');
});
```

## 常见问题

### Q: 为什么不直接支持所有外部服务器？

A: Chrome 扩展的权限模型要求扩展明确声明需要访问的域名。支持任意域名会带来安全风险，并可能导致扩展在 Chrome Web Store 审核时被拒绝。

### Q: 本地代理会影响性能吗？

A: 本地代理的性能开销很小，通常不会明显影响数据传输速度。

### Q: 是否会有支持外部服务器的版本？

A: 我们正在评估安全的实现方式，可能通过以下方式提供：
- 用户手动配置可信域名列表
- 企业版本支持管理员预配置
- 基于证书的服务器验证

## 获取帮助

如果您需要帮助配置外部服务器连接：

- 📝 提交 GitHub Issue: [项目地址]
- 💬 加入讨论: [GitHub Discussions]
- 📧 联系邮箱: [联系邮箱]

---

*本文档会随着功能更新而持续更新。*
