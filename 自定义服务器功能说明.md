# DOM Catcher 自定义服务器功能说明

## 新增功能

### 1. 自定义服务器配置
- 用户可以在扩展弹出窗口中配置自定义的服务器地址
- 支持 HTTP 和 HTTPS 协议
- 配置会自动保存，下次打开时会记住之前的设置
- 默认服务器地址：`http://localhost:3000`

### 2. 服务器在线状态检测
- 实时显示服务器连接状态（在线/离线/检测中）
- 状态指示灯：
  - 🟢 绿色：服务器在线
  - 🔴 红色：服务器离线或连接失败
  - 🟡 橙色：正在检测连接状态
- 自动进行连接测试，也可手动点击"测试连接"按钮

### 3. 智能错误处理
- 详细的错误信息提示（连接超时、服务器错误等）
- 只有在服务器在线时才允许开始选择元素
- 更友好的用户交互体验

## 使用方法

1. **配置服务器**
   - 打开 Chrome 扩展弹出窗口
   - 在"服务器地址"输入框中输入你的服务器地址
   - 点击"测试连接"按钮验证服务器是否可用

2. **检查状态**
   - 观察状态指示器，确保显示为"连接成功"
   - 只有在服务器在线时，"开始选择元素"按钮才会启用

3. **选择元素**
   - 点击"开始选择元素"按钮
   - 在网页上悬停和点击想要捕获的元素
   - 元素将自动发送到配置的服务器

## 服务器要求

你的自定义服务器需要提供以下端点：

1. **状态检查端点**: `GET /status`
   ```json
   {
     "status": "running",
     "message": "DOM Catcher 服务运行中",
     "timestamp": "2025-08-08T10:00:00.000Z"
   }
   ```

2. **接收数据端点**: `POST /receive-dom`
   - 接受 JSON 格式的请求体
   - 包含 `html` 和 `info` 字段
   - 需要支持 CORS 跨域请求

## 配置示例

- **本地开发**: `http://localhost:3000`
- **远程服务器**: `https://your-domain.com:8080`
- **局域网服务**: `http://192.168.1.100:3000`

## 注意事项

1. 确保服务器支持 CORS 跨域请求
2. HTTPS 页面只能连接 HTTPS 服务器（浏览器安全限制）
3. 服务器地址必须包含协议（http:// 或 https://）
4. 连接测试超时时间为 5 秒

## 故障排除

- **连接失败**: 检查服务器地址是否正确，服务器是否启动
- **连接超时**: 检查网络连接，服务器响应是否过慢  
- **CORS 错误**: 确保服务器配置了正确的 CORS 头
- **协议错误**: HTTPS 页面无法访问 HTTP 服务器

## 更新日志

- v1.1: 新增自定义服务器配置和在线状态检测功能
- v1.0: 基础的 DOM 元素捕获功能

## 自动化发布

本扩展已配置 GitHub Actions 自动化发布流程，支持：

### 📦 自动发布到 Chrome Web Store
- 推送版本标签时自动触发发布
- 自动构建扩展包并上传到 Chrome Web Store  
- 创建 GitHub Release 并附带扩展包下载

### 🚀 使用方法
1. **配置认证信息**（仅需一次）
   ```bash
   # 运行认证配置脚本
   node scripts/setup-webstore-auth.js
   
   # 将生成的 Secrets 添加到 GitHub 仓库
   ```

2. **本地测试发布**
   ```bash
   # 测试扩展构建
   ./scripts/test-build.sh
   
   # 快速发布（本地）
   ./scripts/release.sh 1.1.0
   ```

3. **自动化发布**
   ```bash
   # 推送版本标签触发自动发布
   git tag v1.1.0
   git push origin v1.1.0
   ```

### 📋 发布工具
- **Chrome扩展自动化发布指南.md**: 完整配置指南
- **scripts/**: 发布辅助脚本和工具
- **.github/workflows/release.yml**: GitHub Actions 工作流

### 🔧 配置要求
需要在 GitHub Secrets 中配置：
- `GOOGLE_CLIENT_ID`: Google OAuth2 客户端 ID
- `GOOGLE_CLIENT_SECRET`: Google OAuth2 客户端密钥  
- `GOOGLE_REFRESH_TOKEN`: Google OAuth2 刷新令牌
- `EXTENSION_ID`: Chrome 扩展 ID

详细配置步骤请参考 `Chrome扩展自动化发布指南.md`。
